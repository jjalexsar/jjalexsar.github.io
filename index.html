<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>블로그</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <h1>/post 목록</h1>
  <ul id="list"></ul>
  <hr>
  <div id="content">왼쪽에서 글을 선택하세요.</div>

<script>
  // === 설정: 본인 레포 정보로 바꾸세요 ===
  const GITHUB_USER = "jjalexsar";   // 예: jejun-park
  const REPO        = "jjalexsar.github.io";   // 예: blog
  const BRANCH      = "main";        // 예: main / gh-pages
  const POST_DIR    = "src/post";

  const API = `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${encodeURIComponent(POST_DIR)}?ref=${encodeURIComponent(BRANCH)}`;

  const listEl = document.getElementById("list");
  const contentEl = document.getElementById("content");

  // 디렉터리 검색 → md 파일 목록 얻기
  async function loadList(){
    const res = await fetch(API, { headers: { "Accept": "application/vnd.github+json" } });
    if(!res.ok) { listEl.innerHTML = "<li>목록을 불러오지 못했습니다.</li>"; return; }
    const items = (await res.json())
      .filter(f => f.type === "file" && /\.md(?:own)?$/i.test(f.name));

    // 간단 정렬: 이름 오름차순 (원하면 날짜 파싱해 내림차순으로 변경 가능)
    items.sort((a,b)=> a.name.localeCompare(b.name,"ko"));

    for(const f of items){
      const li = document.createElement("li");
      const a  = document.createElement("a");
      a.href = "#";
      a.textContent = f.name;
      a.onclick = async (e)=>{
        e.preventDefault();
        const md = await fetch(f.download_url).then(r=>r.text());
        contentEl.innerHTML = marked.parse(md);
        // 마크다운 내 상대경로를 /post 기준으로 처리하고 싶으면 <base> 사용:
        const base = document.createElement("base");
        base.href = `/${POST_DIR}/`;
        document.head.querySelector("base")?.remove();
        document.head.prepend(base);
      };
      li.appendChild(a);
      listEl.appendChild(li);
    }
  }

  loadList();
</script>
</body>
</html>
