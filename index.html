<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>/post 목록</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <h1>글 목록</h1>
  <div id="err" style="color:#c00;"></div>
  <ul id="list"></ul>
  <hr>
  <div id="content">목록에서 클릭하세요.</div>

<script>
  // === 여기를 본인 값으로 ===
  const GITHUB_USER = "jjalexsar";   // 예: jejun-park
  const REPO        = "jjalexsar.girhub.io";   // 예: blog
  const BRANCH      = "main";        // 예: main / master / gh-pages
  const POST_DIR    = "src/post";    // 예: "post" 또는 "src/post"

  const API = `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${encodeURIComponent(POST_DIR)}?ref=${encodeURIComponent(BRANCH)}`;

  const listEl = document.getElementById("list");
  const contentEl = document.getElementById("content");
  const errEl = document.getElementById("err");

  async function loadList(){
    errEl.textContent = "";
    try {
      const res = await fetch(API, { headers: { "Accept":"application/vnd.github+json" } });
      let payload = null;
      try { payload = await res.json(); } catch(_) {}

      if (!res.ok) {
        errEl.textContent = `목록을 불러오지 못했습니다. HTTP ${res.status} - ` + (payload?.message || "알 수 없는 오류")
          + (payload?.documentation_url ? ` (${payload.documentation_url})` : "");
        console.error("API error:", res.status, payload);
        return;
      }

      const files = (payload || []).filter(f => f.type==="file" && /\.md(?:own)?$/i.test(f.name));
      if (!files.length) {
        errEl.textContent = "해당 경로에 .md 파일이 없습니다. POST_DIR/BRANCH/경로를 확인하세요.";
      }

      files.sort((a,b)=> a.name.localeCompare(b.name,"ko"));

      for (const f of files) {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = f.name;
        a.onclick = async (e)=>{
          e.preventDefault();
          const md = await fetch(f.download_url).then(r=>r.text());
          contentEl.innerHTML = marked.parse(md);

          // 상대경로 보정 (./img.png → /src/post/img.png 등)
          const base = document.createElement("base");
          base.href = `/${POST_DIR}/`;
          document.head.querySelector("base")?.remove();
          document.head.prepend(base);
        };
        li.appendChild(a);
        listEl.appendChild(li);
      }
    } catch (e) {
      errEl.textContent = "네트워크 오류: " + e.message;
      console.error(e);
    }
  }

  loadList();
</script>
</body>
</html>
